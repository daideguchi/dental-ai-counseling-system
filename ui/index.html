<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歯科カウンセリングAIツール</title>
    <link rel="stylesheet" href="styles.css?v=20250816-1600">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- ヘッダー -->
        <header class="app-header">
            <div class="header-content">
                <h1><i class="fas fa-tooth"></i> 歯科カウンセリングAI</h1>
                <p class="subtitle">音声記録からSOAP形式診療記録を自動生成</p>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <!-- ステップインジケーター -->
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-title">ファイル選択</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-title">AI処理</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-title">結果確認</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-title">保存</div>
                </div>
            </div>

            <!-- Step 1: ファイル選択 -->
            <div class="step-content" id="step-1">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-upload"></i> 音声記録ファイルを選択</h2>
                        <p>PLAUD NOTEまたはNottaから出力された<strong>1つのファイル</strong>をアップロード</p>
                    </div>
                    
                    <div class="upload-section">
                        <div class="upload-option">
                            <div class="upload-card plaud-card">
                                <div class="upload-icon">
                                    <i class="fas fa-microphone"></i>
                                </div>
                                <h3>PLAUD NOTE</h3>
                                <p>TXT, MD, MP3, WAV</p>
                                <input type="file" id="plaud-files" accept=".txt,.md,.mp3,.wav" class="file-input">
                                <label for="plaud-files" class="upload-btn">
                                    <i class="fas fa-plus"></i> ファイル選択
                                </label>
                                <div id="plaud-file-list" class="file-list"></div>
                            </div>
                        </div>
                        
                        <div class="upload-divider">
                            <span>または</span>
                        </div>
                        
                        <div class="upload-option">
                            <div class="upload-card notta-card">
                                <div class="upload-icon">
                                    <i class="fas fa-file-audio"></i>
                                </div>
                                <h3>Notta</h3>
                                <p>CSV, XLSX, TXT, SRT, MP3, WAV</p>
                                <input type="file" id="notta-files" accept=".csv,.xlsx,.txt,.srt,.mp3,.wav" class="file-input">
                                <label for="notta-files" class="upload-btn">
                                    <i class="fas fa-plus"></i> ファイル選択
                                </label>
                                <div id="notta-file-list" class="file-list"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="process-files" class="primary-btn" disabled>
                            <i class="fas fa-robot"></i> AI処理開始
                        </button>
                        <button class="info-btn" id="format-info-btn">
                            <i class="fas fa-info-circle"></i> サポート形式
                        </button>
                    </div>
                </div>
                
                <!-- フォーマット情報（折りたたみ） -->
                <div class="format-info-panel" id="format-info" style="display: none;">
                    <div class="format-grid">
                        <div class="format-item">
                            <h4><i class="fas fa-microphone"></i> PLAUD NOTE</h4>
                            <div class="code-examples">
                                <div class="example-block">
                                    <div class="example-header">
                                        <div class="example-title">
                                            <span class="badge txt"><span class="icon">TXT</span> 話者A/B</span>
                                        </div>
                                        <span class="example-ext">.txt</span>
                                    </div>
                                    <pre><code>A: 本日は前歯の見た目が気になります。
B: どのあたりが特に気になりますか？
A: 色と形で、特に右上1番です。</code></pre>
                                </div>

                                <div class="example-block">
                                    <div class="example-header">
                                        <div class="example-title">
                                            <span class="badge md"><span class="icon">MD</span> 要約</span>
                                        </div>
                                        <span class="example-ext">.md</span>
                                    </div>
                                    <pre><code># カウンセリング要約
- 主訴: 前歯の審美（右上1番の色・形）
- 所見: 歯頚部変色、軽度捻転
- 評価: 審美的改善の希望が強い
- 計画: ホワイトニング説明、ラミネート検討</code></pre>
                                </div>

                                <div class="example-block">
                                    <div class="example-header">
                                        <div class="example-title">
                                            <span class="badge audio"><span class="icon">AUDIO</span> メタ</span>
                                        </div>
                                        <span class="example-ext">.mp3 / .wav</span>
                                    </div>
                                    <pre><code>{
  "sampleRateHz": 48000,
  "channels": 1,
  "durationSec": 612.4,
  "format": "wav"
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="format-item">
                            <h4><i class="fas fa-file-audio"></i> Notta</h4>
                            <div class="code-examples">
                                <div class="example-block">
                                    <div class="example-header">
                                        <div class="example-title">
                                            <span class="badge csv"><span class="icon">CSV</span> 表形式</span>
                                        </div>
                                        <span class="example-ext">.csv</span>
                                    </div>
                                    <pre><code>Start Time,End Time,Speaker,Text
00:00:12,00:00:18,Speaker A,本日は前歯の見た目が気になります
00:00:19,00:00:25,Speaker B,どのあたりが特に気になりますか</code></pre>
                                </div>

                                <div class="example-block">
                                    <div class="example-header">
                                        <div class="example-title">
                                            <span class="badge xlsx"><span class="icon">XLS</span> Excel</span>
                                        </div>
                                        <span class="example-ext">.xlsx</span>
                                    </div>
                                    <pre><code>| 開始時刻 | 終了時刻 | 話者    | 内容               |
|----------|----------|---------|-------------------|
| 00:12    | 00:18    | 患者    | 前歯が気になります  |
| 00:19    | 00:25    | 医師    | どちらの前歯ですか  |</code></pre>
                                </div>

                                <div class="example-block">
                                    <div class="example-header">
                                        <div class="example-title">
                                            <span class="badge srt"><span class="icon">SRT</span> 字幕</span>
                                        </div>
                                        <span class="example-ext">.srt</span>
                                    </div>
                                    <pre><code>1
00:00:12,400 --> 00:00:18,200
本日は前歯の見た目が気になります

2
00:00:19,100 --> 00:00:25,800
どのあたりが特に気になりますか？</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: AI処理中 -->
            <div class="step-content" id="step-2" style="display: none;">
                <div class="processing-card">
                    <div class="processing-animation">
                        <div class="spinner"></div>
                        <h2>AI処理中...</h2>
                        <p id="processing-status">ファイル解析を開始しています</p>
                    </div>
                    <div class="processing-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progress-percentage">0%</span>
                            <span id="progress-eta">推定残り時間を計算中...</span>
                        </div>
                    </div>
                    <div class="processing-logs">
                        <h3>処理ログ</h3>
                        <div id="processing-log-list" class="log-list"></div>
                    </div>
                </div>
            </div>

            <!-- Step 3: 解析結果表示 -->
            <div class="step-content" id="step-3" style="display: none;">
                
                <!-- 1. 元データ -->
                <div class="result-section">
                    <h3><i class="fas fa-file-text"></i> 元データ</h3>
                    <div class="original-data-display" id="original-data-content">
                        <!-- 元のテキストデータを表示 -->
                    </div>
                </div>

                <!-- 2. SOAP記録 -->
                <div class="result-section">
                    <h3><i class="fas fa-notes-medical"></i> SOAP記録</h3>
                    <div class="soap-simple-grid">
                        <div class="soap-item">
                            <label>S (主観的情報)</label>
                            <textarea id="soap-s" readonly></textarea>
                        </div>
                        <div class="soap-item">
                            <label>O (客観的所見)</label>
                            <textarea id="soap-o" readonly></textarea>
                        </div>
                        <div class="soap-item">
                            <label>A (評価・診断)</label>
                            <textarea id="soap-a" readonly></textarea>
                        </div>
                        <div class="soap-item">
                            <label>P (治療計画)</label>
                            <textarea id="soap-p" readonly></textarea>
                        </div>
                    </div>
                </div>

                <!-- 3. 評価 -->
                <div class="result-section">
                    <h3><i class="fas fa-chart-line"></i> 評価</h3>
                    <div class="evaluation-summary">
                        <div class="eval-item">
                            <span>成約可能性</span>
                            <span id="eval-communication">-%</span>
                        </div>
                        <div class="eval-item">
                            <span>患者理解度</span>
                            <span id="eval-understanding">-%</span>
                        </div>
                        <div class="eval-item">
                            <span>治療同意</span>
                            <span id="eval-consent">-%</span>
                        </div>
                    </div>
                    
                    <!-- 評価根拠説明 -->
                    <div class="evaluation-reasoning">
                        <div class="reasoning-section">
                            <h4>📊 成約可能性の根拠</h4>
                            <div id="reasoning-communication" class="reasoning-text">分析中...</div>
                        </div>
                        <div class="reasoning-section">
                            <h4>🧠 患者理解度の根拠</h4>
                            <div id="reasoning-understanding" class="reasoning-text">分析中...</div>
                        </div>
                        <div class="reasoning-section">
                            <h4>✅ 治療同意の根拠</h4>
                            <div id="reasoning-consent" class="reasoning-text">分析中...</div>
                        </div>
                    </div>
                </div>

                <!-- 4. DB保存 -->
                <div class="result-section">
                    <h3><i class="fas fa-database"></i> DB保存</h3>
                    <div class="save-status" id="save-status">
                        <span>保存状況: 未保存</span>
                    </div>
                </div>

                <!-- 処理ログ -->
                <div class="result-section">
                    <h3><i class="fas fa-list"></i> 処理ログ</h3>
                    <div class="process-log" id="process-log-display">
                        <!-- 処理ログをここに表示 -->
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="save-soap" class="primary-btn">
                        <i class="fas fa-save"></i> SOAP記録を保存
                    </button>
                    <button id="new-analysis" class="secondary-btn">
                        <i class="fas fa-plus"></i> 新規解析
                    </button>
                    <button id="export-data" class="secondary-btn">
                        <i class="fas fa-download"></i> データ出力
                    </button>
                </div>
            </div>

            <!-- Step 4: 保存完了 -->
            <div class="step-content" id="step-4" style="display: none;">
                <div class="card">
                    <div class="card-header success-header">
                        <h2><i class="fas fa-check-circle"></i> 保存完了</h2>
                        <p>SOAP記録が正常に保存されました</p>
                    </div>
                    
                    <div class="save-success-content">
                        <div class="save-status-section">
                            <h3>💾 保存情報</h3>
                            <div id="save-details" class="save-details">
                                <div class="detail-item">
                                    <span class="detail-label">セッションID:</span>
                                    <span id="saved-session-id" class="detail-value">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">患者名:</span>
                                    <span id="saved-patient-name" class="detail-value">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">保存日時:</span>
                                    <span id="saved-timestamp" class="detail-value">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">データサイズ:</span>
                                    <span id="saved-size" class="detail-value">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="download-section">
                            <h3>📥 ダウンロード</h3>
                            <div id="save-summary" class="download-buttons">
                                <!-- ダウンロードボタンが動的に追加されます -->
                            </div>
                        </div>
                        
                        <div class="next-actions">
                            <h3>🎯 次のアクション</h3>
                            <div class="action-buttons">
                                <button id="back-to-results" class="primary-btn">
                                    <i class="fas fa-arrow-left"></i> 結果に戻る
                                </button>
                                <button id="start-new-analysis" class="secondary-btn">
                                    <i class="fas fa-plus"></i> 新しい解析を開始
                                </button>
                                <button id="view-history" class="secondary-btn">
                                    <i class="fas fa-history"></i> 履歴を確認
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="gemini_integration.js?v=20250816-1600"></script>
    <script src="script.js?v=20250816-1600"></script>
</body>
</html>